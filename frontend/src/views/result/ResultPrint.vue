<template>
  <button class="button-go-back" @click="goBack">〈</button>
  <button class="button-go-home" @click="goHome">Intro</button>
  <div ref="printArea" class="wrapper">
    <landscape-form></landscape-form>
    <portrait-form></portrait-form>
    <audio id="myaudios" loop autoplay volume="0.2">
      <source src="@/assets/audio/out-of-time.mp3" type="audio/mp3" />
    </audio>
  </div>
  <div class="kakao-sharing-btn">
    <button id="kakaotalk-sharing-url-btn" @click="kakaoShare">
      <img
        src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png"
        alt="카카오톡 공유 보내기 버튼"
      />
      친구에게도 인생N컷 추천하기
    </button>
  </div>
  <button id="pdf-button-area" @click="printPdf">결과 PDF로 저장하기</button>
  <button @click="printImage">결과 이미지 저장하기</button>
</template>

<script>
import LandscapeForm from "@/components/result/LandscapeForm.vue";
import PortraitForm from "@/components/result/PortraitForm.vue";
import { useMusicStore } from "@/store/music";
import { useResultStore } from "@/store/result";
import html2pdf from "html2pdf.js";
import { saveAs } from "file-saver";

export default {
  name: "submission-detail",
  data() {
    return {
      result: {},
      from: "",
      output: null,
    };
  },
  components: {
    LandscapeForm,
    PortraitForm,
  },
  methods: {
    goBack() {
      this.$router.go(-1);
    },
    goHome() {
      this.$router.push("/");
    },
    kakaoShare() {
      window.Kakao.Share.sendScrap({
        requestUrl: "https://k7b105.p.ssafy.io/",
        templateId: 85712,
      });
    },
    async printImage() {
      const el = this.$refs.printArea;
      const options = {
        type: "dataURL",
      };
      this.output = await this.$html2canvas(el, options);
      this.downloadItem(this.output);
    },
    async downloadItem(url) {
      await useResultStore()
        .downloadResultImage(url)
        .then(() => {
          const today = new Date();
          const title =
            "인생N컷_여행일지_" +
            today.getFullYear() +
            "" +
            (today.getMonth() + 1) +
            "" +
            today.getDate() +
            ".png";
          saveAs(useResultStore().imageFile, title);
        });
    },
    printPdf() {
      html2pdf(this.$refs.printArea, {
        margin: 0,
        filename: "document.pdf",
        image: { type: "jpg", quality: 0.95 },
        html2canvas: {
          scrollY: 0,
          scale: 1,
          dpi: 300,
          letterRendering: false,
          ignoreElements: function (element) {
            if (element.id == "pdf-button-area") {
              return true;
            }
          },
        },
        jsPDF: {
          orientation: "portrait",
          unit: "in",
          format: [18, 70],
          compressPDF: true,
        },
      });
    },
  },
  mounted() {
    useMusicStore().isSoundActive();
    this.result = useResultStore().resultArticle;
    this.from = useResultStore().from;
    console.log(this.result);
    console.log(this.from);
  },
};
</script>
<style scoped>
.button-go-back {
  position: fixed;
  border: 0.5px solid white;
  background: transparent;
  color: white;
  border-radius: 10%;
  margin: 28px 8px;
  padding: 0px 10px 2px;
  font-size: 20px;
  font-family: Exo;
  z-index: 100;
}
.button-go-back:hover {
  background-color: white;
  color: #141414;
}
.button-go-home {
  position: absolute;
  top: 88%;
  border: 0.5px solid white;
  background: transparent;
  color: white;
  border-radius: 10%;
  margin: 28px 8px;
  padding: 6px 40px 8px;
  font-size: 20px;
  font-family: Exo;
}
.button-go-home:hover {
  background-color: white;
  color: #141414;
}
.kakao-sharing-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.wrapper {
  overflow-x: hidden;
}
</style>
